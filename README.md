# RAG-Food

## é¡¹ç›®ç»“æž„

```
rag_food_project/
â”‚
â”œâ”€â”€ app/                     # ðŸ”§ ä¸»ç³»ç»Ÿé€»è¾‘æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ api/                 # ðŸ“¡ æŽ¥å£æœåŠ¡å±‚ï¼ˆFastAPIï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ endpoints.py     # ç”¨æˆ·é—®é¢˜å…¥å£ã€ä¸Šä¼ æ•°æ®æŽ¥å£
â”‚   â”‚   â””â”€â”€ schema.py        # è¯·æ±‚/å“åº” Pydantic æ¨¡åž‹
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                # ðŸ§  æ¨¡åž‹ä¸Žç®¡é“æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ rag_pipeline.py  # æ•´ä¸ªRAGæµç¨‹ç»„åˆï¼ˆæ£€ç´¢â†’ç”Ÿæˆï¼‰
â”‚   â”‚   â”œâ”€â”€ retriever.py     # å‘é‡å¬å›žé€»è¾‘ï¼ˆMilvus/BM25ï¼‰
â”‚   â”‚   â”œâ”€â”€ generator.py     # ç”Ÿæˆæ¨¡å—ï¼ˆLLMè°ƒç”¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ intent.py        # æ„å›¾è¯†åˆ«æ¨¡åž‹ï¼ˆåˆ†ç±»å™¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ ner.py           # å®žä½“è¯†åˆ«æ¨¡åž‹ï¼ˆNERæŠ½å–ï¼‰
â”‚   â”‚   â””â”€â”€ prompt_template.py # ä¸åŒæ„å›¾/é£Žæ ¼çš„promptæ¨¡æ¿
â”‚   â”‚
â”‚   â”œâ”€â”€ db/                  # ðŸ—ƒ æ•°æ®åº“æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ mysql_client.py  # èœè°±ç»“æž„æŸ¥è¯¢
â”‚   â”‚   â”œâ”€â”€ neo4j_client.py  # é£Ÿæå›¾è°±å…³ç³»æŸ¥è¯¢
â”‚   â”‚   â”œâ”€â”€ milvus_client.py # å‘é‡åº“CRUD
â”‚   â”‚   â””â”€â”€ redis_client.py  # ç”¨æˆ·sessionç¼“å­˜/å‘é‡ç¼“å­˜
â”‚   â”‚
â”‚   â”œâ”€â”€ data_loader/         # ðŸ“¥ æ•°æ®å¯¼å…¥å’Œæ›´æ–°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ load_recipes.py  # è¯»å–JSON/CSVèœè°±å¹¶å¯¼å…¥MySQL
â”‚   â”‚   â”œâ”€â”€ update_vectors.py# å¢žé‡ç”Ÿæˆembeddingå†™å…¥Milvus
â”‚   â”‚   â”œâ”€â”€ build_kg.py      # æž„å»ºNeo4jå›¾è°±æ•°æ®
â”‚   â”‚   â””â”€â”€ embedding.py     # é€šç”¨embeddingç”Ÿæˆå‡½æ•°
â”‚   â”‚
â”‚   â””â”€â”€ utils/               # ðŸ›  å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ logger.py        # æ—¥å¿—æ¨¡å—
â”‚       â”œâ”€â”€ timer.py         # ç”¨äºŽç»Ÿè®¡æ¨¡å—è€—æ—¶
â”‚       â””â”€â”€ config.py        # å…¨å±€é…ç½®ï¼ˆæ•°æ®åº“åœ°å€ã€æ¨¡åž‹è·¯å¾„ç­‰ï¼‰
â”‚
â”œâ”€â”€ tests/                   # ðŸ§ª å•å…ƒ/é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ test_retriever.py    # æ£€ç´¢è´¨é‡æµ‹è¯•ï¼ˆrecall@kç­‰ï¼‰
â”‚   â”œâ”€â”€ test_generator.py    # ç”Ÿæˆæ•ˆæžœæµ‹è¯•ï¼ˆBLEUç­‰ï¼‰
â”‚   â”œâ”€â”€ test_pipeline.py     # æ•´ä½“RAGæµç¨‹æµ‹è¯•
â”‚   â”œâ”€â”€ test_ner_intent.py   # æ„å›¾è¯†åˆ«ä¸ŽNERæµ‹è¯•
â”‚   â””â”€â”€ mock_data.json       # æµ‹è¯•ç”¨é—®é¢˜/èœè°±æ•°æ®
â”‚
â”œâ”€â”€ scripts/                 # âš™ï¸ ç®¡ç†ä¸Žè°ƒåº¦è„šæœ¬
â”‚   â”œâ”€â”€ run_server.py        # å¯åŠ¨FastAPIæœåŠ¡
â”‚   â”œâ”€â”€ daily_update.py      # å®šæ—¶å¢žé‡æ›´æ–°è„šæœ¬ï¼ˆå‘é‡+MySQLï¼‰
â”‚   â”œâ”€â”€ rebuild_index.py     # å…¨é‡é‡å»ºMilvusç´¢å¼•
â”‚   â””â”€â”€ eval_rag.py          # ç”¨Ragasè¯„ä¼°RAGæ•´ä½“æ€§èƒ½
â”‚
â”œâ”€â”€ notebooks/               # ðŸ““ å®žéªŒ/æ•°æ®åˆ†æžï¼ˆJupyterï¼‰
â”‚   â”œâ”€â”€ explore_user_intents.ipynb
â”‚   â”œâ”€â”€ visualize_kg.ipynb
â”‚   â””â”€â”€ prototype_demo.ipynb
â”‚
â”œâ”€â”€ data/                    # ðŸ—‚ åˆå§‹æ ·æœ¬æ•°æ®
â”‚   â”œâ”€â”€ raw/                 # åŽŸå§‹æ•°æ®ï¼ˆjson/csvï¼‰
â”‚   â”œâ”€â”€ processed/           # æ¸…æ´—åŽçš„æ•°æ®æ–‡ä»¶
â”‚   â””â”€â”€ embeddings/          # ç”Ÿæˆçš„å‘é‡ï¼ˆå¯ç¼“å­˜ï¼‰
â”‚
â”œâ”€â”€ .env                     # çŽ¯å¢ƒå˜é‡ï¼ˆAPIå¯†é’¥ã€æ•°æ®åº“è¿žæŽ¥ï¼‰
â”œâ”€â”€ requirements.txt         # ä¾èµ–åº“æ¸…å•
â”œâ”€â”€ README.md                # é¡¹ç›®è¯´æ˜Žæ–‡æ¡£
â””â”€â”€ pyproject.toml           # Pythoné¡¹ç›®æž„å»ºé…ç½®ï¼ˆå¯é€‰ï¼‰

```

## å„æ¨¡å—ä½œç”¨è¯´æ˜Ž
### ðŸ”§ app/
ç³»ç»Ÿä¸»é€»è¾‘æ¨¡å—ï¼š
- api/ï¼šé€šè¿‡ FastAPI æä¾› REST æŽ¥å£ï¼Œæ”¯æŒé—®ç­”è°ƒç”¨ã€ä¸Šä¼ æ•°æ®ã€çŠ¶æ€æŸ¥è¯¢ã€‚
- core/ï¼š
    - rag_pipeline.pyï¼šå°†æ„å›¾è¯†åˆ« + æ£€ç´¢ + ç”Ÿæˆæ•´åˆä¸ºç»Ÿä¸€æŽ¥å£
    - retriever.pyï¼šåŸºäºŽMilvus/FAISSç­‰çš„Top-kå¬å›ž
    - generator.pyï¼šå°è£…LLMè°ƒç”¨ï¼ˆQwenã€OpenAIç­‰ï¼‰ï¼Œå¸¦Promptæž„å»º
    - intent.py / ner.pyï¼šæ„å›¾è¯†åˆ«ä¸Žå®žä½“è¯†åˆ«æ¨¡å—ï¼Œå°è£…æ¨¡åž‹åŠ è½½ä¸Žé¢„æµ‹

- db/ï¼š
    - mysql_client.pyï¼šç”¨äºŽç»“æž„åŒ–å­—æ®µç­›é€‰ã€æŽ¨èã€åˆ†é¡µæŸ¥è¯¢ç­‰
    - neo4j_client.pyï¼šé£Ÿæ-å±žæ€§å›¾è°±çš„å¤šè·³å…³ç³»æŸ¥è¯¢
    - milvus_client.pyï¼šembeddingç”Ÿæˆä¸ŽMilvusè¿žæŽ¥ï¼ˆæ’å…¥/æ›´æ–°/æ£€ç´¢ï¼‰
    - redis_client.pyï¼šç¼“å­˜ç”¨æˆ·é—®é¢˜ã€embeddingæŸ¥è¯¢ç»“æžœã€ä¼šè¯åŽ†å²

- data_loader/ï¼š
    - æä¾›èœè°±å¯¼å…¥ã€å›¾è°±æž„å»ºã€å‘é‡ç”Ÿæˆç­‰å¯å¤ç”¨ä»»åŠ¡ã€‚

- utils/ï¼šé€šç”¨å·¥å…·ï¼Œå¦‚æ—¥å¿—ã€è€—æ—¶ç»Ÿè®¡ã€å…¨å±€é…ç½®ã€‚

### ðŸ§ª tests/
æµ‹è¯•æ¨¡å—ï¼š

- å•å…ƒæµ‹è¯•æ¯ä¸ªå­ç³»ç»Ÿæ˜¯å¦æ­£å¸¸å·¥ä½œï¼ˆæ£€ç´¢ã€ç”Ÿæˆã€NERã€æ„å›¾ï¼‰
- æä¾›Mockæ ·æœ¬ï¼Œç”¨äºŽé›†æˆæµ‹è¯•æ•´æ¡é—®ç­”æµç¨‹
- å¯é›†æˆåˆ°CIï¼ˆå¦‚GitHub Actionsï¼‰ä¸­

### âš™ï¸ scripts/
è°ƒåº¦ä¸Žè¿ç»´è„šæœ¬ï¼š

- run_server.pyï¼šè¿è¡ŒFastAPIæœåŠ¡
- daily_update.pyï¼šå®šæ—¶æ‹‰å–æ–°å¢žèœè°± + æ›´æ–°Embedding
- rebuild_index.pyï¼šå…¨éƒ¨é‡å»ºï¼ˆé€‚ç”¨äºŽç»“æž„å˜åŠ¨åŽï¼‰
- eval_rag.pyï¼šä½¿ç”¨Ragas/è‡ªå®šä¹‰è¯„ä¼°å·¥å…·å¯¹ç³»ç»Ÿæ€§èƒ½æ‰“åˆ†

### ðŸ““ notebooks/
å¿«é€ŸåŽŸåž‹ã€æ•°æ®åˆ†æžã€å¯è§†åŒ–æ¨¡å—ï¼š

- ç”¨æˆ·æ„å›¾æŽ¢ç´¢ï¼ˆè¯äº‘ã€èšç±»ï¼‰
- èœè°±å›¾è°±å¯è§†åŒ–
- å¤šæ¨¡åž‹å¯¹æ¯”æµ‹è¯•

### ðŸ—‚ data/
æ•°æ®ç›®å½•ï¼š

- raw/ï¼šä½ æœ€åˆä¸Šä¼ çš„æ ·æœ¬æ–‡ä»¶ï¼Œå¦‚samples.json
- processed/ï¼šè½¬æ¢æˆç»“æž„åŒ–å­—æ®µçš„æ•°æ®
- embeddings/ï¼šå‘é‡æ–‡ä»¶ï¼ˆå¯ç¼“å­˜äºŽç£ç›˜/Redisï¼‰

### ðŸ é¡¹ç›®è¿è¡Œå»ºè®®
>å¯åŠ¨æœåŠ¡
```
python scripts/run_server.py
```

>æœ¬åœ°æµ‹è¯•
```
pytest tests/
```

>æ¯æ—¥æ•°æ®å¢žé‡æ›´æ–°
```
python scripts/daily_update.py
```

>RAGç³»ç»Ÿæ•ˆæžœè¯„ä¼°
```
python scripts/eval_rag.py
```